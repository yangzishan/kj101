<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" /> 
<meta content="telephone=no" name="format-detection" />
<title>个人中心</title>
<link rel="stylesheet" type="text/css" href="css/basic.css" />
<link rel="stylesheet" type="text/css" href="css/style.css?t=201805022" />
<link rel="stylesheet" type="text/css" href="css/LCalendar.css">
</head>
<body>
<section class="my_view" id="appVUE">
<!--<div class="top-nav"><a class="goback" href="javascript:history.go(-1);"></a><span class="tit">个人资料</span></div>-->
<div class="pson_t">
	<p class="btit">{{language.la_wanshan}}</p>
	<div class="nikimg">
		<p><img :src="headimgurl" id="userImg"></p>
	</div>
	<p class="nikname"><a id="setNickName">{{nickName}}</a></p>
</div>

<div class="psonInforSet">
	<p class="p_row">
		<label class="lab">{{language.la_cell}}</label>
		<span class="intxt">{{mobile}}</span>
	</p>
	<a class="p_row" id="setSex">
		<label class="lab">{{language.la_sex}}</label>
		<span class="intxt" id="sexStr">{{sex==1?language.la_male:language.la_female}}</span>
	</a>
	<p class="p_row">
		<label class="lab">{{language.la_birthday}}</label>
		<input class="intxt" id="demo1" readonly="true" type="text" placeholder="请输入您的生日" unselectable="on" data-lcalendar="1920-01-1,2005-12-31" :value="birthdayStr" />
	</p>
	<a class="p_row" id="setHeight">
		<label class="lab">{{language.la_height}}</label>
		<span class="intxt sho_height"><em>{{height}}</em>cm</span>
	</a>
	<a class="p_row" id="setWeight">
		<label class="lab">{{language.la_weight}}</label>
		<span class="intxt sho_weight"><em>{{weight}}</em>kg</span>
	</a>
	<a class="p_row" id="setCard">
		<label class="lab">{{language.la_cardManag}}</label>
		<span class="intxt sho_weight"><em id="">健康筛查卡</em></span>
	</a>
	<a class="p_row" id="setCoupon">
		<label class="lab">{{language.la_coupon}}</label>
		<span class="intxt sho_weight"><em id="">{{language.la_coupon}}</em></span>
	</a>
</div>
<p class="psontip">{{language.la_rushi}}</p>

<div class="kjcopy_d">
	<p class="p1"><span id="notice">《{{language.la_titUp}}》</span></p>
	<p class="p2">{{language.la_k_company}}</p>
	<!--<p class="p3">Copyright &copy; 2011-2017 Konstar.All Rights Reserved.</p>-->
</div>

<input type="hidden" id="userId" value="" />
<div class="load-overlay" style="display: none;"><img class="loadimg" src="img/loading.gif"></div>

<div class="v_overlay"></div>
<div class="v_overlert" id="showNotice">
	<div class="tc_sy">
		<em class="close"></em>
		<p class="bit">
			<span class="labt">{{language.la_noteTit}}</span>
		</p>
		<div class="bxt2">
			<p>{{language.la_noteWel}}</p>
			<p>{{language.la_noto1}}</p>
			<p>{{language.la_note2}}</p>
			<p>{{language.la_note3}}</p>
			<p>{{language.la_note4}}</p>
			<p>{{language.la_note5}}</p>
			<p>{{language.la_note6}}</p>
			<p>{{language.la_note7}}</p>
			<p>{{language.la_note8}} </p>
			<p>{{language.la_note9}}</p>
			<p>{{language.la_note10}}</p>
			<p>{{language.la_note11}}</p>
			<p>{{language.la_note12}}</p>
			<p style="text-align: center; padding: .2rem 0; color: #666;">{{language.la_k_company}}<br><em style="color: #999; font-size: .2rem;">Copyright &copy; 2011-2017 Konstar.All Rights Reserved.</em></p>
		</div>
	</div>
</div>

</section>

<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/base.js"></script>
<script type="text/javascript" src="js/vue.min.js"></script>
<script type="text/javascript" src="js/language.js"></script>
<script type="text/javascript" src="zhuge.js"></script>
<script type="text/javascript" src="js/LCalendar.js"></script>
<!--<script type="text/javascript" src="js/LCalendar_reg.js"></script>-->
<script type="text/javascript">
(function (doc, win) {
    var docEl = doc.documentElement,
        resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
        recalc = function () {
            var clientWidth = docEl.clientWidth;
            if (!clientWidth) return;
            if(clientWidth>=750){
                docEl.style.fontSize = '100px';
            }else{
                docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
            }
        };
    if (!doc.addEventListener) return;
    win.addEventListener(resizeEvt, recalc, false);
    doc.addEventListener('DOMContentLoaded', recalc, false);
})(document, window);
</script>
<script>
var userId = getQueryString("userId");
var JsSrc =(navigator.language || navigator.browserLanguage).toLowerCase();  //获取系统语言
if(JsSrc.indexOf('zh')>=0){
	var language = zh;
	var languageStr = 'zh';
}else if(JsSrc.indexOf('en')>=0){
    var language = en;
    var languageStr = 'en';
    document.title = 'Personal Center'
}else{
	var language = en;
    var languageStr = 'en';
    document.title = 'Personal Center'
}
if(userId){
	getUserInfor(userId)
}
$('#userId').val(userId);  //修改生日用

zhuge.track('进入个人中心页', { //埋点t
	'用户id' : userId,
	'渠道' : '微信'
});
/*******************************交互逻辑*****************************/
setupWebViewJavascriptBridge(function(bridge) {
	// 注册JS方法供OC调用
	bridge.registerHandler('getUserId', function(data, responseCallback) {
		//alert('哈哈哈哈')
		//判断iOS和Android
		var u = navigator.userAgent;
		if (u.indexOf('Android') > -1 || u.indexOf('Linux') > -1) {//安卓手机
			var obj = eval("("+data+")");	
		} else if (u.indexOf('iPhone') > -1) {//苹果手机
			var obj = eval(data);
		} else if (u.indexOf('Windows Phone') > -1) {//winphone手机
			alert("不支持该手机设备");
		}
		userId = obj.userId;
		$('#userId').val(userId);  //修改生日用
		//var responseData = { 'code':'200' };responseCallback(responseData);
		if (userId) {
			getUserInfor(userId);
		};
	})
	// 为按钮注册方法
	$(document).on("click","#userImg",function(){
		//alert('hahahha');
		bridge.callHandler('upLoadIco', {'price':'100'}, function responseCallback(responseData) {});
	});
})
/*******************************交互逻辑*****************************/
function getUserInfor(userId){
	var myapp = new Vue({
		el: '#appVUE',
		data: function(){
			return{
				headimgurl: '', //用户头像
			    nickName: '', //用户昵称
			    mobile: '', //手机号
			    sex: '', //性别   1男 2女
			    birthday: '', //生日
			    birthdayStr: '',
			    height: '', //身高
			    weight: '', //体重
			    language: language,
			}
		},
		mounted: function(){
			this.findUserById();
		},
		methods: {
			findUserById: function(){
				var vm = this;
				$.ajax({
					url : dataUrl + "/api/v1/reportUser/findUserById",
					type : "post",
					dataType : 'json',
				    data : {
				    	userId: userId
				    },
					success : function(userData) {
						console.log(userData)
						vm.headimgurl = userData.data.headimgurl
					    vm.nickName = userData.data.nickName
					    vm.mobile = userData.data.mobile
					    vm.sex = userData.data.sex
					    vm.birthday = userData.data.birthday
					    vm.birthdayStr = userData.data.birthdayStr
					    vm.height = userData.data.height
					    vm.weight = userData.data.weight;
		
						//修改昵称和性别身高体重跳转
						$('#setNickName').attr("href","personal_nickname.html?userId="+userId+"&nickName="+vm.nickName);
						$('#setSex').attr("href","personal_sex.html?userId="+userId+"&sex="+vm.sex);
						$('#setHeight').attr("href","personal_height.html?userId="+userId+"&height="+vm.height);
						$('#setWeight').attr("href","personal_weight.html?userId="+userId+"&weight="+vm.weight);
						//体验卡跳转、优惠券跳转
						$('#setCard').attr("href",testHealthUrl+"/tjCard.html?userId="+userId);
						$('#setCoupon').attr("href",testHealthUrl+"/couponList.html?userId="+userId);
					   	var calendar = new lCalendar();
						calendar.init({
							'trigger': '#demo1',
							'type': 'date'
						});
					    $("#demo1").focus(function(){
					        document.activeElement.blur();
					    });
					    
					    //阅读用户须知弹出
						$('#notice').on("click",function(){
							$('.v_overlay').css({"visibility":"visible","opacity":"1"});
							$('#showNotice').css({"visibility":"visible","opacity":"1"});
							$('#showNotice').on("touchmove",function(){
								event.stopPropagation();
							});
							$(document).on('touchmove',function(e){
								e.preventDefault();//阻止滚动
							});
						});
						$('.v_overlert .close').click(function(){
							$('.v_overlay').css({"visibility":"hidden","opacity":"0"});
							$('.v_overlert').css({"visibility":"hidden","opacity":"0"});
							$(document).off("touchmove");
						});
					
					}
				});
	
			},
		}
	});
};
	

function getQueryString(name){
     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
     var r = window.location.search.substr(1).match(reg);
     if(r!=null)return  unescape(r[2]); return null;
};
function setupWebViewJavascriptBridge(callback) {
	if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
	if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
	window.WVJBCallbacks = [callback];
	var WVJBIframe = document.createElement('iframe');
	WVJBIframe.style.display = 'none';
	WVJBIframe.src = 'https://__bridge_loaded__';
	document.documentElement.appendChild(WVJBIframe);
	setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
};	
</script>
</body>
</html>
