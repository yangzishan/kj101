<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" /> 
    <meta content="telephone=no" name="format-detection" />
    <title>健康管理</title>
    <link rel="stylesheet" href="./css/basic.css">
    <!-- <link rel="stylesheet" href="./css/skin.css"> -->
    <script>
        document.write('<link rel="stylesheet" href="css/skin.css?t='+new Date().getTime()+'">')
    </script>
</head>
<body class="fiveone">
<div class="loadmore loading"></div>
<div id="app_501">
        <div class="head_bg">
                <div class="center">
                    <h2>健康管理</h2>
                    <div class="user_history">
                        <img class="yonghu" src="./img/skin/user_501.png" alt="" @click="goSetUp();">
                        <img class="lishi" src="./img/skin/history_501.png" alt="" @click="checkHistory();">
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="list jkbaogao">
                    <div class="progress">
                        <span class="circle">
                            <div class="circle_pro" style="width: 1.18rem; height: 1.18rem; position: relative;">
                                <em style="position: absolute; top: 35%;left:42.5%; transform: translate(-50%,0); text-align:center; font-size:.48rem;font-weight: 900;">0</em><i style="position: absolute;bottom:.30rem;right:.15rem;font-size:.24rem;font-weight: 900;">分</i>
                            </div>
                            <div id="angle1" style=" width: .6rem; height: .86rem; position: absolute; top: -.25rem; left:24%; margin-left: -.18rem; transform-origin: bottom center; transition: transform 1000ms cubic-bezier(0.57, -0.04, 0.65, 0.98) 0s;">
                                <img class="img_b" src='./img/skin/501_lvdian.png'>
                            </div>
                        </span>
                    </div>
                    <div class="title">
                        <div class="left">
                            <p>健康报告</p>
                            <span v-cloak>{{inspectDate}}</span>
                        </div>
                        <div class="right">
                            <!-- <img src="./img/skin/right_501.png" alt=""> -->
                            <p class="alt" v-cloak>{{ps}}</p>
                            <p><i></i></p>
                        </div>
                    </div>
                </div>
                <div class="list skin" v-if="skinTotalScore && skinTotalScore != null && skinTotalScore != 0">
                    <div class="progress">
                        <span class="circle">
                            <div class="circle_pro" style="width: 1.18rem; height: 1.18rem; position: relative;">
                                <em style="position: absolute; top: 35%;left:42.5%; transform: translate(-50%,0); text-align:center; font-size:.48rem;font-weight: 900;">0</em><i style="position: absolute;bottom:.30rem;right:.15rem;font-size:.24rem;font-weight: 900;">分</i>
                            </div>
                            <div id="angle2" style=" width: .6rem; height: .86rem; position: absolute; top: -.25rem; left:24%; margin-left: -.18rem; transform-origin: bottom center; transition: transform 1000ms cubic-bezier(0.57, -0.04, 0.65, 0.98) 0s;">
                                <img class="img_b" src='./img/skin/501_fendian.png'>
                            </div>
                        </span>
                    </div>
                    <div class="title">
                            <div class="left">
                                <p>皮肤报告</p>
                                <span v-cloak>{{inspectDate}}</span>
                            </div>
                            <div class="right">
                                <p><i></i></p>
                            </div>
                        </div>
                </div>
                <div class="list heart">
                    <div class="img">
                        <img src="./img/skin/xinzanggongneng_501.png" alt="">
                    </div>
                    <div class="title">
                        <div class="left">
                            <p>心脏功能</p>
                            <span v-cloak>{{inspectDate}}</span>
                        </div>
                        <div class="right">
                            <p><i></i></p>
                        </div>
                    </div>
                </div>
                <div class="list loop">
                    <div class="img">
                        <img src="./img/skin/weixunhuan_501.png" alt="">
                    </div>
                    <div class="title">
                        <div class="left">
                            <p>微循环</p>
                            <span v-cloak>{{inspectDate}}</span>
                        </div>
                        <div class="right">
                            <p><i></i></p>
                        </div>
                    </div>
                </div>
            </div>
</div>



    <script src="js/jquery.js"></script>
    <script src="./js/vue.min.js"></script>
    <script src="js/circle-progress.js"></script>
    <script src="./js/base.js"></script>
    <script type="text/javascript">
        (function (doc, win) {
            var   docEl = doc.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function () {
                    var   clientWidth = docEl.clientWidth;
                    if (!clientWidth) return;
                    if(clientWidth>=750){
                        docEl.style.fontSize = '100px';
                    }else{
                        docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
                    }
                };
        
            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
    </script>
    <script>
        $(function(){
            var reportId = getQueryString('reportId');//'KJ111IS00067S4C190102184339730';//
            var openId = getQueryString('openId');//'oDOut0eU-yPSvA-L9sUMZeFIkHyo';//
            var edition = 500;
            // var  customerId = getQueryString('customerId');
            var urlSearch = '';
            new Vue({
                el:'#app_501',
                data:{
                   "totalScore": '',
                   "skinTotalScore": '',
                   "inspectDate": '',
                   "reportCode": "",
                   "ps": "",
                   userId:''
                },
                methods:{
                    zhuan:function(){
                        var  that = this;
                        var  w = $(window).width();
                        if(w>750){
                            w = 750;
                        }
                        $('.jkbaogao .circle_pro').circleProgress({
                              value: that.totalScore/100,
                              size:w * 0.16 ,
		                	    startAngle: Math.PI*1.5,
		                	    emptyFill: '#edf6fb',
		                	    fill:{
		                	    	color: '#f6fbfe',
		                	    	image: './img/skin/quan_501.png'
		                	    }
		                	}).on('circle-animation-progress', function(event, progress) {
		                	    $(this).find('em').html(parseInt(that.totalScore * progress));
		                	});
                        $('#angle1').css("transform","rotate("+ that.totalScore/100*360 +"deg)");      
                          // no2
                        $('.skin .circle_pro').circleProgress({
                              value: that.skinTotalScore/100,
                              size:w * 0.16 ,
		                	    startAngle: Math.PI*1.5,
		                	    emptyFill: '#edf6fb',
		                	    fill:{
		                	    	color: '#f6fbfe',
		                	    	image: './img/skin/quan_5011.png'
		                	    }
		                	}).on('circle-animation-progress', function(event, progress) {
		                	    $(this).find('em').html(parseInt(that.skinTotalScore * progress));
		                	});
                        $('#angle2').css("transform","rotate("+ that.skinTotalScore/100*360 +"deg)");       
                    },
                    inspectIndex:function(){
                        var  that = this;
                        $.ajax({
                            url: dataUrl + '/api/v5/inspectSkinIndex/inspectIndex',
                            data:{
                                openId:openId,
                                reportCode: reportId
                            },
                            type:'POST',
                            success:function(res){
                               if(res.code == 200){
                                   
                                    that.totalScore = res.data.totalScore;
                                    that.ps = res.data.ps;
                                    that.inspectDate = new Date(res.data.inspectDate).getFullYear() + '-' + that.buWei(parseInt(new Date(res.data.inspectDate).getMonth()+1)) + '-' + that.buWei(new Date(res.data.inspectDate).getDate()) + ' ' + that.buWei(new Date(res.data.inspectDate).getHours()) + ':' + that.buWei(new Date(res.data.inspectDate).getMinutes()) + ':' + that.buWei(new Date(res.data.inspectDate).getSeconds());
                                    that.reportCode = res.data.reportCode;
                                    that.skinTotalScore = res.data.skinTotalScore;
                                    that.totalScore = res.data.totalScore;
                                    that.userId = res.data.userId;
                                    setTimeout(function(){
                                        $('#app_501').css({'display':'block'});
                                        $('.loadmore.loading').css({'display':'none'});
                                        that.zhuan();
                                    },5)
                                    urlSearch = '?' + 'reportId=' + reportId+ '&edition=' + edition ;
                               }else if(res.code = 201){
                                    window.location.href = 'payfor501.html?reportId='+reportId+'&openId='+openId+'&edition='+edition+'&sameUser='+res.data.sameUser;
                               }
                            }
                        });
                    },
                    analysisReport:function(){
                        var  that = this;
                        $.ajax({
                            url: dataUrl + '/api/v1/reportIndex/analysisReport',
                            data:{
                                reportId:reportId,
                                openId:openId
                            },
                            type:'POST',
                            success:function(res){
                                if(res.code == 200){
                                    that.inspectIndex();
                                }else if(res.code == 402){
                                   window.location.href="userInfor.html?reportId=" + reportId+"&userId=" + res.data.customerId + "&openId=" + openId + "&edition="+edition;
                                }else if(res.code == 403){
                                    window.location.href="supAge.html?reportId=" + reportId+"&userId=" + res.data.customerId + "&openId=" + openId + "&edition="+edition;
                                }else if(res.code == 405){
                                    window.location.href="userInfor.html?reportId=" + reportId + "&openId=" + openId + "&edition="+edition;
                                }else if(res.code == 2002){
                                    alert('kj501接口调用失败  analysisReport  code=' + res.code)
                                }else if(res.code == 2003){
                                    alert('kj501调用接口皮肤数据为空  analysisReport  code=' + res.code)
                                }else if(res.code == 2004){
                                    alert('kj501调用接口生物电数据为空  analysisReport  code=' + res.code)
                                }else if(res.code == 2005){
                                    alert('kj501调用接口心电数据为空  analysisReport  code=' + res.code)
                                }else if(res.code == 2006){
                                    alert('kj501调用接口血氧数据为空  analysisReport  code=' + res.code)
                                }
                            }
                        })
                    },
                    buWei:function(date){
                        if(date<10){
                            return '0'+date;
                        }
                        return date;
                    },
                    checkHistory: function(e){ //历史报告
			            window.location.href = dataUrl + "/wxUser/wxUserReport?jumpUrl=uiHistory&userId=" + this.userId + "&openId=" + openId + '&reportId=' + reportId
		            },
		            goSetUp: function(e){ //个人中心
			            window.location.href = dataUrl + "/wxUser/wxUserReport?jumpUrl=uiUser&userId=" + this.userId + '&reportId='+ reportId
		            },
                },
                mounted:function(){
                    this.analysisReport();
                }
            });
            $('.content').on('click','.list',function(){
                if($(this).hasClass('jkbaogao')){
                    window.location.href = 'index2.html' + urlSearch+'&openId=' + openId;
                }else if($(this).hasClass('heart')){
                    console.log(1)
                    window.location.href = 'heart.html' + urlSearch;
                }else if($(this).hasClass('loop')){
                    console.log(2)
                    window.location.href = 'loop.html' + urlSearch;
                }else if($(this).hasClass('skin')){
                    console.log(3)
                    window.location.href = 'skin.html' + urlSearch;
                }
            })
           // 获取url参数方法
           function getQueryString(name) {
                var   result = window.location.search.match(new RegExp("[\?\&]" + name + "=([^\&]+)", "i"));
                if (result == null || result.length < 1) {
                    return "";
                }
                return result[1];
            };
        });      
    </script>
</body>