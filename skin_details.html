<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" name="viewport" />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" /> 
    <meta content="telephone=no" name="format-detection" />
    <title>皮肤报告</title>
    <link rel="stylesheet" href="css/basic.css">
    <link rel="stylesheet" href="css/skin.css">
</head>
<body id="body">
    <div class="loadmore loading loa"></div>
    <div id="app">
            <div class="mask" @click="hidePhoto();" ></div>
            <div class="photo">
                    <img :src="sex.more" alt="">
            </div>
            <div class="details_header">
                    <p>{{title}}</p>
                    <a href="javascript:;" @click="goHistory"><img src="./img/skin/break.png"/>返回</a>
                </div>
                <div class="details_tab">
                    <img :src="sex.zhongdian" alt="">
                    <ul>
                        <li class="" v-for="(item,index) in dataList.list" :data-targetName="item.targetName" :data-score="item.score" :data-index="index" @click="loadDetails($event)">
                            <span v-cloak>{{item.name}}</span>
                        </li>
                    </ul>
                </div>
                <!-- showface -->
                <div class="showface">
                    <h2><span></span>您的痘痘情况</h2>
                    <div class="more">
                        <div class="more_left">
                            <div class="img_faker"></div>
                            <img class="heitou" :style="s_obj.heitou" src="./img/skin/heitou.png" alt="">
                            <img class="bandian" :style="s_obj.bandian" src="./img/skin/bandian.png" alt="">
                            <img class="huangheban" :style="s_obj.huangheban" src="./img/skin/huangheban.png" alt="">
                            <img class="doudou" :style="s_obj.doudou" src="./img/skin/doudou.png" alt="">
                            <img class="fenci" :style="s_obj.fenci" src="./img/skin/fenci.png" alt="">
                            <img class="zhouwen" :style="s_obj.zhouwen" src="./img/skin/zhouwen.png" alt="">
                            <!-- <img class="img_true" @click="showPhoto" src="./img/skin/more.png" alt=""> -->
                            <div class="img_true"  @click="showPhoto">
                                    <span>查看<br>原图</span>
                                    <img :src="sex.more" alt="">
                            </div>
                        </div>
                        <div class="more_right">
                            <div class="top" >
                                <p class="p_count" v-show="!!skin.indexnum"><span v-cloak>{{skin.indexnum}}</span>个</p>
                                <p class="p_title" v-show="!!skin.indexnum" v-cloak>{{skin.skinGuide.skinParaName}}数量</p>
                            </div>
                            <div class="bottom">
                                <div class="progress">
                                    <span v-bind:style="{width:skin.num+'%'}"></span>
                                </div>
                                <p class="colooo" v-cloak>{{bijiao}}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="reason">
                    <h2><span></span>引起原因</h2>
                    <div class="loadmore loading lll">正在加载...</div>
                    <div  class="title hide_p" v-html="skin.skinGuide.paraCause">
                    </div>
                </div>
                <hr>
                <div class="proposal">
                    <h2><span></span>护理建议</h2>
                    <div class="title">
                        <h3><img :src="sex.tanhao" alt="">从生活起居做起</h3>
                        <div class="loadmore loading lll">正在加载...</div>
                        <p class="hide_p" v-html="skin.skinGuide.paraLifeSuggestion"></p>
                        <h3 class="day"><img :src="sex.tanhao" alt="">日常清洁</h3>
                        <div class="loadmore loading lll">正在加载...</div>
                        <p class="hide_p" v-html="skin.skinGuide.paraSkincareSuggestion"></p>
                    </div>
                </div>
    </div>
    <script src="js/jquery.js"></script>
    <script src="js/base.js"></script>
    <script src="js/vue.min.js"></script>
    <script type="text/javascript">
        (function (doc, win) {
            var docEl = doc.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function () {
                    var clientWidth = docEl.clientWidth;
                    if (!clientWidth) return;
                    if(clientWidth>=750){
                        docEl.style.fontSize = '100px';
                    }else{
                        docEl.style.fontSize = 100 * (clientWidth / 750) + 'px';
                    }
                };
        
            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);
    </script>
    <script>
    $(function(){
        var reportCode = getQueryString('reportCode');
        var openId = getQueryString('openId');
        var degree = getQueryString('degree');
        var sex =  getQueryString('sex');
        var s_obj = {
            heitou:'display:none',
            bandian:'display:none',
            huangheban:'display:none',
            doudou:'display:none',
            fenci:'display:none',
            zhouwen:'display:none',
        };

        var classna = sex == 1 ? 'active' : 'active_n';
        new Vue({
            el:'#app',
            data:{
                title:'皮肤详情',
                dataList:{
                    list:'',
                    num:'',
                    reportCode:''
                },
                skin:{
                    indexnum:'',
                    name:'',
                    num:'',
                    skinGuide:{
                        paraCause:'',
                        paraExplain:'',
                        paraLifeSuggestion:'',
                        paraSkincareSuggestion:'',
                        skinParaCode:'',
                        skinParaId:'',
                        skinParaName:'',
                        skinParaResult:''
                    }
                },
                liClass:'',
                indexnum:[],
                bijiao:'',
                sex:{
                    num:'1',
                    color:'color:#4ba0ff;',
                    color_b:'#c7e1fd',
                    color_e:'#4ba0ff',
                    bgColor:'background-color:#ecf5fe;',
                    face:'./img/skin/newmanface.png',
                    more:'./img/skin/yuehannidepu.jpg'   ,
                    zhongdian:'./img/skin/lookblue.png',
                    tanhao:'./img/skin/lantanhao.png'
                },
                s_obj:s_obj,
            },
            mounted:function(){
                this.loadData()
            },
            methods:{
                loadDetails:function(event){
                    $('.hide_p').css({'display':'none'});
                    $('.lll').css({'display':'block'});
                    $('.top').css({'visibility':'hidden'});
                    $('.bottom>p').css({'display':'none'});
                    let that = this;
                    let obj = {
                        reportCode:'2221',
                        name:event.currentTarget.getAttribute('data-targetName')+'_score',
                        score:event.currentTarget.getAttribute('data-score'),
                        code:event.currentTarget.getAttribute('data-targetName'),
                        indexnum:that.indexnum[event.currentTarget.getAttribute('data-index')]
                    }
                    $.ajax({  // tab栏切换
                        url:dataUrl + '/api/v3/inspectSkinDetail/findInspectSkinDetailVo',
                        type:'POST',
                        data:obj,
                        success:function(res){
                            if(res.code == 200){
                                $('.hide_p').css({'display':'block'});
                                $('.lll').css({'display':'none'});
                                $('.top').css({'visibility':'visible'});
                                $('.bottom>p').css({'display':'block'});
                                that.skin = res.data;
                                that.skin.skinGuide.paraCause = that.skin.skinGuide.paraCause.replace(/\n/g,'<br>');
                                that.skin.skinGuide.paraLifeSuggestion = that.skin.skinGuide.paraLifeSuggestion.replace(/\n/g,'<br>');
                                that.skin.skinGuide.paraSkincareSuggestion = that.skin.skinGuide.paraSkincareSuggestion.replace(/\n/g,'<br>');
                            }
                        }
                    });
                },
                loadData:function(){
                    let that = this;
                    that.title = degree == 'skinMajor' ? '继续保持' : '重点关注'
                    $.ajax({  //请求列表
                        url:dataUrl + '/api/v3/inspectSkinDetail/findInspectSkinVoList',
                        type:'POST',
                        data:{ 
                            reportCode:'2222',
                            degree:degree,
                            openId:openId
                        },
                        success:function(res){
                            if(res.code == 200){
                                that.sex.num = sex; 
                                that.sex.color = sex == 1 ? '#4ba0ff' : '#ff4b6f';
                                that.sex.bgColor = sex == 1 ? '#ecf5fe' : '#ffe9ed';                     
                                that.sex.face = sex == 1 ? 'skin/nanxiangqing.png' : 'skin/nvxiangqing.png';
                                that.sex.color_b = sex == 1 ? '#c7e1fd' : '#ffcdd7';
                                that.sex.color_e = sex == 1 ? '#4ba0ff' : '#ff4b6f';
                                that.sex.tanhao = sex == 1 ? './img/skin/lantanhao.png' : './img/skin/pink.png';
                                that.sex.zhongdian = sex == 1 ? './img/skin/lookblue.png' : './img/skin/lookpink.png';
                                console.log(that.sex)
                                $('.loa').css({'display':'none'});
                                $('#app').css({'display':'block'});
                                that.dataList = res.data;
                                for(let i = 0; i < res.data.list.length; i++){
                                    if(res.data.list[i].count){
                                        that.indexnum.push(res.data.list[i].count)
                                    }else{
                                        that.indexnum.push('')
                                    }
                                }
                                setTimeout(function(){$('.details_tab>ul>li:first-child').addClass(classna);
                                    $('.progress span').css({'background': 'linear-gradient(to right,'+that.sex.color_b+',' +that.sex.color_e+')'});
                                    $('h2>span').css({'background':that.sex.color});
                                    console.log($('.img_faker'))
                                    $('.img_faker').css({'background':'url(./img/'+that.sex.face+') no-repeat center','background-size':'contain'});
                                    console.log($('.proress p'))
                                    $('.colooo').css({'color':that.sex.color})
                                },5);
                                $.ajax({   //请求第一项详情
                                    url:dataUrl + '/api/v3/inspectSkinDetail/findInspectSkinDetailVo',
                                    type:'POST',
                                    data:{
                                        reportCode:'2221',
                                        name:that.dataList.list[0].targetName+'_score',
                                        score:that.dataList.list[0].score,
                                        code:that.dataList.list[0].targetName,
                                        indexnum: !that.dataList.list[0].count ? '' : that.dataList.list[0].count
                                    },
                                    success:function(res){
                                        if(res.code == 200){
                                            $('.lll').css({'display':'none'});
                                            that.skin = res.data;
                                            that.skin.skinGuide.paraCause = that.skin.skinGuide.paraCause.replace(/\n/g,'<br>');
                                            that.skin.skinGuide.paraLifeSuggestion = that.skin.skinGuide.paraLifeSuggestion.replace(/\n/g,'<br>');
                                            that.skin.skinGuide.paraSkincareSuggestion = that.skin.skinGuide.paraSkincareSuggestion.replace(/\n/g,'<br>');
                                            that.bijiao = '您的状态好于'+that.skin.num+'%的人';
                                            console.log(res.data)
                                        }
                                    }
                                });
                            }
                        }
                    });
                },
                goHistory:function(){
                    history.back()
                },
                showPhoto:function(){
                    console.log(1)
                    $('.mask').addClass('show');
                    $('.photo').addClass('show');
                    sTop = $(window).scrollTop();
                    $('body').css({'position':'fixed','top':-sTop});
                },
                hidePhoto:function(){
                    console.log(2);
                    $('.mask').removeClass('show');
                    $('.photo').removeClass('show');
                    $('body').css({'position':'static'}); 
                    $(window).scrollTop(sTop);
                }
            }
        });
        function tabActive(){
           
            $('.active').removeClass('active');
            $('.'+ classna).removeClass(classna);
            $(this).addClass(classna);
            let index = $(this).index();
            let en = $('body#body .details_tab>img');
            index == 0 ? en.css({'left':'14%','top':'.15rem'}) : index == 1 ?  en.css({'left':'35%','top':'.15rem'}) : index == 2 ? en.css({'left':'58%','top':'.15rem'}) : index == 3 ? en.css({'left':'83%','top':'.15rem'}) : index == 4 ? en.css({'left':'14%','top':'1.3rem'}) : en.css({'left':'14%','top':'.15rem'}) ;
            s_obj.heitou = $(this).attr('data-targetName') == 'blackhead' ? 'display:block;' : 'display:none;';
            s_obj.bandian = $(this).attr('data-targetName') == 'spot' ? 'display:block;' : 'display:none;';
            s_obj.huangheban  = $(this).attr('data-targetName') == 'chloasma' ? 'display:block;' : 'display:none;';
            s_obj.doudou = $(this).attr('data-targetName') == 'pimple' ? 'display:block;' : 'display:none;';
            s_obj.fenci =$(this).attr('data-targetName') == 'acne' ? 'display:block;' : 'display:none;';
            s_obj.zhouwen = $(this).attr('data-targetName') == 'wrinkle' ? 'display:block;' : 'display:none;';
        }
        $('.details_tab>ul').on('click','li',tabActive);
        // 获取url参数方法
        function getQueryString(name) {
            var result = window.location.search.match(new RegExp("[\?\&]" + name + "=([^\&]+)", "i"));
            if (result == null || result.length < 1) {
                return "";
            }
            return result[1];
        };
    });
    </script>
</body>
</html>